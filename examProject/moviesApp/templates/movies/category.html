{% extends "base.html" %}
{% load static %}

{% block title %}
电影分类
{% endblock %}

{% block content %}
<!-- 广告横幅 -->
<div class="container-fluid">
    <div class="row">
        <img class="img-responsive model-img" src="{% static 'img/movies1.jpg' %}" 
                 alt="电影分类横幅">
    </div>
</div>

<!-- 主体内容 -->
<div class="container">
    <div class="row row-3">
        <!-- 侧边导航栏 -->
        <div class="col-md-3">
            <div class="model-title">
                电影库
            </div>
            <div class="model-list">
                <ul class="list-group">
                    <li class="list-group-item" id="movie_home">
                        <a href="{% url 'moviesApp:movie_home' %}">电影库首页</a>
                    </li>
                    <li class="list-group-item active" id="category">
                        <a href="{% url 'moviesApp:category' %}">电影分类</a>
                    </li>
                    <li class="list-group-item" id="search">
                        <a href="{% url 'moviesApp:search' %}">电影搜索</a>
                    </li>
                </ul>
            </div>
        </div>
        <!-- 说明文字和图片 -->
        <div class="col-md-9">
            <div class="model-details-title">
                电影分类浏览
            </div>
            <div class="model-details">
                <div class="row">
                    <img class="img-responsive" src="{% static 'img/category.jpg' %}">
                </div>
                <p>
                    电影分类浏览功能让您能够按照电影类型快速找到感兴趣的电影。我们提供了多种电影分类，包括动作、喜剧、爱情、科幻、恐怖、悬疑等。点击左侧的分类链接可以查看该分类下的所有电影。每部电影都标注了基本信息和评分，方便您做出选择。
                </p>
                
                <h4>选择分类</h4>
                <div class="row">
                    <div class="col-md-12">
                        <div class="list-group">
                            <a href="?category=" class="list-group-item list-group-item-action {% if not selected_category %}active{% endif %}">
                                全部电影
                            </a>
                            {% for cat in categories %}
                            <a href="?category={{ cat.id }}" 
                               class="list-group-item list-group-item-action {% if selected_category == cat.id|stringformat:'i' %}active{% endif %}">
                                {{ cat.name }}
                            </a>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                
                <h4>电影列表</h4>
                <div class="row">
                    {% for movie in movies %}
                    <div class="col-md-4">
                        <div class="thumbnail" style="border: 1px solid #ddd; padding: 10px; margin-bottom: 20px;">
                            <div class="caption">
                                <h5>{{ movie.title }}</h5>
                                
                                <!-- 修复：添加海报显示 -->
                                {% if movie.poster %}
                                    <img src="{{ movie.poster.url }}" 
                                         alt="{{ movie.title }}"
                                         style="width: 100%; height: 200px; object-fit: cover; margin-bottom: 10px;">
                                {% else %}
                                    <img src="https://via.placeholder.com/300x200/ffc107/333?text={{ movie.title }}" 
                                         alt="{{ movie.title }}"
                                         style="width: 100%; height: 200px; object-fit: cover; margin-bottom: 10px;">
                                {% endif %}
                                
                                <p>分类：{{ movie.category.name }}</p>
                                <p>评分：⭐ {{ movie.rating }}</p>
                                <p>导演：{{ movie.director }}</p>
                                <p>
                                    <a href="{% url 'moviesApp:details' movie.id %}" class="btn btn-primary btn-sm">查看详情</a>
                                </p>
                            </div>
                        </div>
                    </div>
                    {% empty %}
                    <div class="col-md-12">
                        <div class="alert alert-info">暂无电影数据</div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}